<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;8.&nbsp;EPL Reference: Functions</title><link rel="stylesheet" href="../shared/css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="Esper - Event Stream and Complex Event Processing for Java"><link rel="up" href="index.html" title="Esper - Event Stream and Complex Event Processing for Java"><link rel="previous" href="epl-operator.html" title="Chapter&nbsp;7.&nbsp;EPL Reference: Operators"><link rel="next" href="epl-views.html" title="Chapter&nbsp;9.&nbsp;EPL Reference: Views"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;8.&nbsp;EPL Reference: Functions</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="epl-operator.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="epl-views.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="functionreference"></a>Chapter&nbsp;8.&nbsp;EPL Reference: Functions</h2></div></div><div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="epl-single-row-function-ref"></a>8.1.&nbsp;Single-row Function Reference</h2></div></div><div></div></div><p>
			Single-row functions return a single value for every single result row generated by your statement. These functions can appear anywhere where expressions are allowed.
		</p><a class="indexterm" name="d0e13810"></a><a class="indexterm" name="d0e13813"></a><a class="indexterm" name="d0e13818"></a><p>
			Esper allows static Java library methods as single-row functions, and also features built-in single-row functions. In addition, Esper allows instance method invocations on named streams.
		</p><p>
			Esper auto-imports the following Java library packages:
		</p><div class="itemizedlist"><ul type="disc" compact><li><p>
					java.lang.*
				</p></li><li><p>
					java.math.*
				</p></li><li><p>
					java.text.*
				</p></li><li><p>
					java.util.*
				</p></li></ul></div><p>
			Thus Java static library methods can be used in all expressions as shown in below example:
		</p><pre class="programlisting">select symbol, Math.round(volume/1000)
from StockTickEvent.win:time(30 sec)</pre><p>
			In general, arbitrary Java class names have to be fully qualified (e.g. java.lang.Math) but Esper provides a mechanism 
for user-controlled imports of classes and packages as outlined in <a href="configuration.html#config-class--package-imports" title="11.4.5.&nbsp;Class and package imports">Section&nbsp;11.4.5, &#8220;Class and package imports&#8221;</a>.
		</p><p>
			The below table outlines the built-in single-row functions available.
		</p><div class="table"><a name="epl-single-row-func"></a><p class="title"><b>Table&nbsp;8.1.&nbsp;Syntax and results of single-row functions</b></p><table summary="Syntax and results of single-row functions" border="1"><colgroup><col><col></colgroup><thead><tr><th>Single-row Function</th><th>Result</th></tr></thead><tbody><tr><td><pre class="synopsis">case <span class="emphasis"><em>value</em></span> 
  when <span class="emphasis"><em>compare_value</em></span> then <span class="emphasis"><em>result</em></span>
  [when <span class="emphasis"><em>compare_value</em></span> then <span class="emphasis"><em>result</em></span> ...] 
  [else <span class="emphasis"><em>result</em></span>] 
  end </pre></td><td><p>
								Returns <tt class="literal">result</tt> where the first <tt class="literal">value</tt> equals <tt class="literal">compare_value</tt>. 
							</p></td></tr><tr><td><pre class="synopsis">case 
  when <span class="emphasis"><em>condition</em></span> then <span class="emphasis"><em>result</em></span>
  [when <span class="emphasis"><em>condition</em></span> then <span class="emphasis"><em>result</em></span> ...] 
  [else <span class="emphasis"><em>result</em></span>] 
  end</pre></td><td><p>
								Returns the <tt class="literal">result</tt> for the first condition that is true.
							</p></td></tr><tr><td><pre class="synopsis">cast(<span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>type_name</em></span>)</pre></td><td><p>
								Casts the result of an expression to the given type. 
							</p></td></tr><tr><td><pre class="synopsis">coalesce(<span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>expression</em></span> [, <span class="emphasis"><em>expression</em></span> ...])</pre></td><td><p>
								Returns the first non-<tt class="literal">null</tt> value in the list, or <tt class="literal">null</tt> if there are no non-<tt class="literal">null</tt> values.
							</p></td></tr><tr><td><pre class="synopsis">current_timestamp[()]</pre></td><td><p>
								Returns the current engine time as a <tt class="literal">long</tt> millisecond value. Reserved keyword with optional parenthesis.
							</p></td></tr><tr><td><pre class="synopsis">exists(<span class="emphasis"><em>dynamic_property_name</em></span>)</pre></td><td><p>
								Returns true if the dynamic property exists for the event, or false if the property does not exist.
							</p></td></tr><tr><td><pre class="synopsis">instanceof(<span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>type_name</em></span> [, <span class="emphasis"><em>type_name</em></span> ...])</pre></td><td><p>
								Returns true if the expression returns an object whose type is one of the types listed.
							</p></td></tr><tr><td><pre class="synopsis">max(<span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>expression</em></span> [, <span class="emphasis"><em>expression</em></span> ...])</pre></td><td><p>
								Returns the highest numeric value among the 2 or more comma-separated expressions.
							</p></td></tr><tr><td><pre class="synopsis">min(<span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>expression</em></span> [, <span class="emphasis"><em>expression</em></span> ...])</pre></td><td><p>
								Returns the lowest numeric value among the 2 or more comma-separated expressions.
							</p></td></tr><tr><td><pre class="synopsis">prev(<span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>event_property)</em></span></pre></td><td><p>
								Returns a property value of a previous event, relative to the event order within a data window 
							</p></td></tr><tr><td><pre class="synopsis">prior(<span class="emphasis"><em>integer</em></span>, <span class="emphasis"><em>event_property)</em></span></pre></td><td><p>
								Returns a property value of a prior event, relative to the natural order of arrival of events
							</p></td></tr></tbody></table></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="epl-single-row-function-ref-case"></a>8.1.1.&nbsp;The <tt class="literal">Case</tt> Control Flow Function</h3></div></div><div></div></div><a class="indexterm" name="d0e14056"></a><a class="indexterm" name="d0e14059"></a><p>
				The <tt class="literal">case</tt> control flow function has two versions. The first version takes a value and a list of compare values to compare against, and returns the result where the first value equals the compare value. The second version takes a list of conditions and returns the result for the first condition that is true.
			</p><p>
				The return type of a <tt class="literal">case</tt> expression is the compatible aggregated type of all return values.
			</p><p>
				The example below shows the first version of a <tt class="literal">case</tt> statement. It has a <tt class="literal">String</tt> return type and returns the value 'one'.
			</p><pre class="programlisting">select case 1 when 1 then 'one' when 2 then 'two' else 'more' end from ...</pre><p>
				The second version of the <tt class="literal">case</tt> function takes a list of conditions. The next example has a <tt class="literal">Boolean</tt> return type and returns the boolean value true.
			</p><pre class="programlisting">select case when 1&gt;0 then true else false end from ...</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="epl-single-row-function-cast"></a>8.1.2.&nbsp;The <tt class="literal">Cast</tt> Function</h3></div></div><div></div></div><a class="indexterm" name="d0e14100"></a><a class="indexterm" name="d0e14103"></a><p>
				The <tt class="literal">cast</tt> function casts the return type of an expression to a designated type. The function accepts two parameters: The first parameter is the property name or expression that returns the 
				value to be casted. The second parameter is the type to cast to.
			</p><p>
				Valid parameters for the second (type) parameter are:
			</p><div class="itemizedlist"><ul type="disc"><li><p>
						Any of the Java built-in types: <tt class="literal">int, long, byte, short, char, double, float, string, BigInteger, BigDecimal</tt>, where <tt class="literal">string</tt>  is a short notation for <tt class="literal">java.lang.String</tt> and <tt class="literal">BigInteger</tt> as well as <tt class="literal">BigDecimal</tt> are the classes in <tt class="literal">java.math</tt>. The type name is not case-sensitive. For example:
						</p><pre class="synopsis">cast(price, double)</pre><p>
					</p></li><li><p>
						The fully-qualified class name of the class to cast to, for example: </p><pre class="synopsis">cast(product, org.myproducer.Product)</pre><p>
					</p></li></ul></div><p>
				The <tt class="literal">cast</tt> function is often used to provide a type for dynamic (unchecked) properties. Dynamic properties are properties whose type is not known at compile type. 
				These properties are always of type <tt class="literal">java.lang.Object</tt>. 
			</p><p>
				The <tt class="literal">cast</tt> function as shown in the next statement casts the dynamic "price" property of an "item" in the OrderEvent to a double value.
			</p><pre class="programlisting">select cast(item.price?, double) from OrderEvent</pre><p>
				The <tt class="literal">cast</tt> function returns a <tt class="literal">null</tt> value if the expression result cannot be casted to the desired type, or if the expression result itself is <tt class="literal">null</tt>.
			</p><p>
				The <tt class="literal">cast</tt> function adheres to the following type conversion rules:
			</p><div class="itemizedlist"><ul type="disc"><li><p>
						For all numeric types, the <tt class="literal">cast</tt> function utilitzes <tt class="literal">java.lang.Number</tt> to convert numeric types, if required. 
					</p></li><li><p>
						For casts to <tt class="literal">string</tt> or <tt class="literal">java.lang.String</tt>, the function calls <tt class="literal">toString</tt> on the expression result.
					</p></li><li><p>
						For casts to other objects including application objects, the <tt class="literal">cast</tt> function considers a Java class's superclasses as well as all directly or indirectly-implemented interfaces by superclasses .
					</p></li></ul></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="epl-single-row-function-ref-coalesce"></a>8.1.3.&nbsp;The <tt class="literal">Coalesce</tt> Function</h3></div></div><div></div></div><a class="indexterm" name="d0e14211"></a><a class="indexterm" name="d0e14214"></a><p>
				The result of the <tt class="literal">coalesce</tt> function is the first expression in a list of expressions that returns a non-null value. The return type is the compatible aggregated type of all return values.
			</p><p>
				This example returns a String-typed result of value 'foo':
			</p><pre class="programlisting">select coalesce(null, 'foo') from ...</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="epl-single-row-function-ref-currenttime"></a>8.1.4.&nbsp;The <tt class="literal">Current_Timestamp</tt> Function</h3></div></div><div></div></div><a class="indexterm" name="d0e14234"></a><a class="indexterm" name="d0e14237"></a><p>
				The <tt class="literal">current_timestamp</tt> function is a reserved keyword and requires no parameters. The result of the <tt class="literal">current_timestamp</tt> function is the <tt class="literal">long</tt>-type millisecond value of the current engine system time.
			</p><p>
				The function returns the current engine timestamp at the time of expression evaluation. When using external-timer events, the function provides the last value of the externally-supplied time at the time of expression evaluation.
			</p><p>
				This example selects the current engine time:
			</p><pre class="programlisting">select current_timestamp from MyEvent
// equivalent to
select current_timestamp() from MyEvent</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="epl-single-row-function-exists"></a>8.1.5.&nbsp;The <tt class="literal">Exists</tt> Function</h3></div></div><div></div></div><a class="indexterm" name="d0e14265"></a><a class="indexterm" name="d0e14268"></a><p>
				The <tt class="literal">exists</tt> function returns a boolean value indicating whether the dynamic property, provided as a parameter to the function, exists on the event. The <tt class="literal">exists</tt> function accepts a single dynamic property name as its only parameter. 
			</p><p>
				The <tt class="literal">exists</tt> function is for use with dynamic (unchecked) properties. Dynamic properties are properties whose type is not known at compile type. Dynamic properties return a null value
				if the dynamic property does not exists on an event, or if the dynamic property exists but the value of the dynamic property is null. 
			</p><p>
				The <tt class="literal">exists</tt> function as shown next returns true if the "item" property contains an object that has a "serviceName" property. It returns false if the "item" property is null, or if the "item" property does not 
				contain an object that has a property named "serviceName" :
			</p><pre class="programlisting">select exists(item.serviceName?) from OrderEvent</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="epl-single-row-function-instanceof"></a>8.1.6.&nbsp;The <tt class="literal">Instance-Of</tt> Function</h3></div></div><div></div></div><a class="indexterm" name="d0e14299"></a><a class="indexterm" name="d0e14302"></a><p>
				The <tt class="literal">instanceof</tt> function returns a boolean value indicating whether the type of value returned by the expression is one of the given types. The first parameter to the <tt class="literal">instanceof</tt> function is an expression to evaluate. The second and subsequent parameters are Java type names.
			</p><p>
				The function determines the return type of the expression at runtime by evaluating the expression, and compares the type of object returned by the expression to the defined types. 
				If the type of object returned by the expression matches any of the given types, the function returns <tt class="literal">true</tt>. If the expression returned <tt class="literal">null</tt> or a type that does not
				match any of the given types, the function returns <tt class="literal">false</tt>.
			</p><p>
				The <tt class="literal">instanceof</tt> function is often used in conjunction with dynamic (unchecked) properties. Dynamic properties are properties whose type is not known at compile type. 
			</p><p>
				This example uses the <tt class="literal">instanceof</tt> function to select different properties based on the type:
			</p><pre class="programlisting">select case when instanceof(item, com.mycompany.Service) then serviceName?
  when instanceof(item, com.mycompany.Product) then productName? end 
  from OrderEvent</pre><p>
				The <tt class="literal">instanceof</tt> function returns <tt class="literal">false</tt> if the expression tested by instanceof returned null.
			</p><p>
				Valid parameters for the type parameter list are:
			</p><div class="itemizedlist"><ul type="disc"><li><p>
						Any of the Java built-in types: <tt class="literal">int, long, byte, short, char, double, float, string</tt>, where <tt class="literal">string</tt>  is a short notation for <tt class="literal">java.lang.String</tt>. The type name is not case-sensitive. For example, the next function tests if the dynamic "price" property is either of type float or type double:
						</p><pre class="synopsis">instanceof(price?, double, float)</pre><p>
					</p></li><li><p>
						The fully-qualified class name of the class to cast to, for example: </p><pre class="synopsis">instanceof(product, org.myproducer.Product)</pre><p>
					</p></li></ul></div><p>
				The function considers an event class's superclasses as well as all the directly or indirectly-implemented interfaces by superclasses.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="epl-single-row-function-ref-minmax"></a>8.1.7.&nbsp;The <tt class="literal">Min</tt> and <tt class="literal">Max</tt> Functions</h3></div></div><div></div></div><a class="indexterm" name="d0e14381"></a><a class="indexterm" name="d0e14384"></a><a class="indexterm" name="d0e14389"></a><a class="indexterm" name="d0e14392"></a><p>
				The <tt class="literal">min</tt> and <tt class="literal">max</tt> function take two or more parameters that itself can be expressions. The <tt class="literal">min</tt> function returns the lowest numeric value among the 2 or more comma-separated expressions, while the <tt class="literal">max</tt> function returns the highest numeric value.
				The return type is the compatible aggregated type of all return values.
			</p><p>
				The next example shows the <tt class="literal">max</tt> function that has a <tt class="literal">Double</tt> return type and returns the value 1.1.
			</p><pre class="programlisting">select max(1, 1.1, 2 * 0.5) from ...</pre><p>
				The <tt class="literal">min</tt> function returns the lowest value. The statement below uses the function to determine the smaller of two timestamp values.
			</p><pre class="programlisting">select symbol, min(ticks.timestamp, news.timestamp) as minT
	from StockTickEvent.win:time(30 sec) as ticks, NewsEvent.win:time(30 sec) as news
	where ticks.symbol = news.symbol</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="epl-single-row-function-ref-previous"></a>8.1.8.&nbsp;The <tt class="literal">Previous</tt> Function</h3></div></div><div></div></div><a class="indexterm" name="d0e14434"></a><a class="indexterm" name="d0e14437"></a><p>
				The <tt class="literal">prev</tt> function returns the property value of a previous event. The first parameter denotes the i-th previous event in the order established by the data window. 
				The second parameter is a property name for which the function returns the value for the previous event.
			</p><p>
				This example selects the value of the <tt class="literal">price</tt> property of the 2nd-previous event from the current Trade event.
			</p><pre class="programlisting">select prev(2, price) from Trade.win:length(10)</pre><p>
				Since the <tt class="literal">prev</tt> function takes the order established by the data window into account, the function works well with sorted windows. In the following example the statement
				selects the symbol of the 3 Trade events that had the largest, second-largest and third-largest volume.
			</p><pre class="programlisting">select prev(0, symbol), prev(1, symbol), prev(2, symbol)
  from Trade.ext:sort(volume, true, 10)</pre><p>
				The i-th previous event parameter can also be an expression returning an Integer-type value. The next statement joins the Trade data window with an <tt class="literal">RankSelectionEvent</tt> event that provides a <tt class="literal">rank</tt> property used to look up a certain position in the sorted Trade data window:
			</p><pre class="programlisting">select prev(rank, symbol) from Trade.ext:sort(volume, true, 10), RankSelectionEvent</pre><p>
				And the expression <tt class="literal">count(*) - 1</tt> allows us to select the oldest event in the length window:
			</p><pre class="programlisting">select prev(count(*) - 1, price) from Trade.win:length(100)</pre><p>
				The <tt class="literal">prev</tt> function returns a <tt class="literal">null</tt> value if the data window does not currently hold the i-th previous event. The example below illustrates this using a time batch window. Here the <tt class="literal">prev</tt>  
				function returns a null value for any events in which the previous event is not in the same batch of events. Note that the <tt class="literal">prior</tt> function as discussed below can be used if a null value is not the desired result.
			</p><pre class="programlisting">select prev(1, symbol) from Trade.win:time_batch(1 min)</pre><p>
				An alternative form of the <tt class="literal">prev</tt> function allows the index to not appear or appear after the property name if the index value is a constant and not an expression:
			</p><pre class="programlisting">select prev(1, symbol) from Trade
// ... equivalent to ...
select prev(symbol) from Trade
// ... and ...
select prev(symbol, 1) from Trade</pre><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="epl-single-row-function-ref-prev-group"></a>8.1.8.1.&nbsp;Previous Event per Group</h4></div></div><div></div></div><p>
					The combination of <tt class="literal">prev</tt> function and group-by view returns the property value for a previous event in the given group. 
				</p><p>
					Let's look at an example. Assume we want to obtain the price of the previous event of the same symbol as the current event.
				</p><p>
					The statement that follows solves this problem. It declares a group-by view grouping on the symbol property and a time window of 1 minute. As a result, when the engine encounters a new symbol value that it hasn't seen before, it creates a new time window specifically to hold events for that symbol. Consequently, the previous function returns the previous event within the respective time window for that event's symbol value. 
				</p><pre class="programlisting">select prev(1, price) as prevPrice from Trade.std:groupby(symbol).win:time(1 min)</pre><p>
					In a second example, assume we need to return, for each event, the current top price per symbol. We can use the <tt class="literal">prev</tt> to obtain the highest price from a sorted data window, and use the group-by view to group by symbol:
				</p><pre class="programlisting">select prev(0, price) as topPricePerSymbol 
from Trade.std:groupby(symbol).ext:sort(price, false, 1)</pre></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="epl-single-row-function-ref-prev-restrictions"></a>8.1.8.2.&nbsp;Restrictions</h4></div></div><div></div></div><p>
						The following restrictions apply to the <tt class="literal">prev</tt> functions and its results:
				</p><div class="itemizedlist"><ul type="disc" compact><li><p>
							The function always returns a <tt class="literal">null</tt> value for remove stream (old data) events
						</p></li><li><p>
							The function requires a data window view, or a group-by and data window view, without any additional sub-views. See <a href="epl-views.html" title="Chapter&nbsp;9.&nbsp;EPL Reference: Views">Chapter&nbsp;9, <i>EPL Reference: Views</i></a> for built-in data window views.
						</p></li></ul></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="epl-single-row-function-ref-prev-prior"></a>8.1.8.3.&nbsp;Comparison to the <tt class="literal">prior</tt> Function</h4></div></div><div></div></div><p>
					The <tt class="literal">prev</tt> function is similar to the <tt class="literal">prior</tt> function. The key differences between the two functions are as follows:				 
				</p><div class="itemizedlist"><ul type="disc" compact><li><p>
							The <tt class="literal">prev</tt> function returns previous events in the order provided by the data window, while the <tt class="literal">prior</tt> function returns prior events in the order of arrival as posted by a stream's declared views.
						</p></li><li><p>
							The <tt class="literal">prev</tt> function requires a data window view while the <tt class="literal">prior</tt> function does not have any view requirements.
						</p></li><li><p>
							The <tt class="literal">prev</tt> function returns the previous event grouped by a criteria by combining the <tt class="literal">std:groupby</tt> view and a data window. The <tt class="literal">prior</tt> function returns prior events posted by the last view regardless of data window grouping.
						</p></li><li><p>
							The <tt class="literal">prev</tt> function returns a <tt class="literal">null</tt> value for remove stream events, i.e. for events leaving a data window. 
							The <tt class="literal">prior</tt> function does not have this restriction.
						</p></li></ul></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="epl-single-row-function-ref-prior"></a>8.1.9.&nbsp;The <tt class="literal">Prior</tt> Function</h3></div></div><div></div></div><a class="indexterm" name="d0e14605"></a><a class="indexterm" name="d0e14608"></a><p>
				The <tt class="literal">prior</tt> function returns the property value of a prior event. The first parameter is an integer value that denotes the i-th prior event in the natural order of arrival. 
				The second parameter is a property name for which the function returns the value for the prior event.
			</p><p>
				This example selects the value of the <tt class="literal">price</tt> property of the 2nd-prior event to the current Trade event.
			</p><pre class="programlisting">select prior(2, price) from Trade</pre><p>
				The <tt class="literal">prior</tt> function can be used on any event stream or view and does not have any specific view requirements.  The function operates on the order of arrival of events by the event stream or view that provides the events.
			</p><p>
				The next statement uses a time batch window to compute an average volume for 1 minute of Trade events, posting results every minute. The select-clause 
				employs the <tt class="literal">prior</tt> function to select the current average and the average before the current average:
			</p><pre class="programlisting">select average, prior(1, average) 
    from TradeAverages.win:time_batch(1 min).stat:uni(volume)</pre></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="epl-function-aggregation"></a>8.2.&nbsp;Aggregate Functions</h2></div></div><div></div></div><a class="indexterm" name="d0e14640"></a><p>
			The syntax of the aggregation functions and the results they produce are shown in below table.
		</p><div class="table"><a name="epl-grouping-aggregate-func-table"></a><p class="title"><b>Table&nbsp;8.2.&nbsp;Syntax and results of aggregate functions</b></p><table summary="Syntax and results of aggregate functions" border="1"><colgroup><col><col></colgroup><thead><tr><th>Aggregate Function</th><th>Result</th></tr></thead><tbody><tr><td>avedev([all|distinct] <span class="emphasis"><em>expression</em></span>)</td><td><p>
								Mean deviation of the (distinct) values in the expression, returning a value of <tt class="literal">double</tt> type.
							</p></td></tr><tr><td>avg([all|distinct] <span class="emphasis"><em>expression</em></span>)</td><td><p>
								Average of the (distinct) values in the expression, returning a value of <tt class="literal">double</tt> type.
							</p></td></tr><tr><td>count([all|distinct] <span class="emphasis"><em>expression</em></span>)</td><td><p>
								Number of the (distinct) non-null values in the expression, returning a value of <tt class="literal">long</tt> type.
							</p></td></tr><tr><td>count(*)</td><td><p>
								Number of events, returning a value of <tt class="literal">long</tt> type.
							</p></td></tr><tr><td>max([all|distinct] <span class="emphasis"><em>expression</em></span>)</td><td><p>
								Highest (distinct) value in the expression, returning a value of the same type as the expression itself returns.
							</p></td></tr><tr><td>median([all|distinct] <span class="emphasis"><em>expression</em></span>)</td><td><p>
								Median (distinct) value in the expression, returning a value of <tt class="literal">double</tt> type. Double Not-a-Number (NaN) values are ignored in the median computation.
							</p></td></tr><tr><td>min([all|distinct] <span class="emphasis"><em>expression</em></span>)</td><td><p>
								Lowest (distinct) value in the expression, returning a value of the same type as the expression itself returns.
							</p></td></tr><tr><td>stddev([all|distinct] <span class="emphasis"><em>expression</em></span>)</td><td><p>
								Standard deviation of the (distinct) values in the expression, returning a value of <tt class="literal">double</tt> type.
							</p></td></tr><tr><td>sum([all|distinct] <span class="emphasis"><em>expression</em></span>)</td><td><p>
								Totals the (distinct) values in the expression, returning a value of <tt class="literal">long, double, float or integer</tt> type depending on the expression.
							</p></td></tr></tbody></table></div><p>
			Your application may also add its own aggregation function as <a href="extension.html#custom-aggregation-function" title="12.2.&nbsp;Custom Aggregation Functions">Section&nbsp;12.2, &#8220;Custom Aggregation Functions&#8221;</a> describes.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="epl-function-user-defined"></a>8.3.&nbsp;User-Defined Functions</h2></div></div><div></div></div><a class="indexterm" name="d0e14766"></a><a class="indexterm" name="d0e14769"></a><a class="indexterm" name="d0e14774"></a><p>
			 A user-defined function (UDF) can be invoked anywhere as an expression itself or within an expresson. The function must simply be a public static method
			 that the classloader can resolve at statement creation time. The engine resolves the function reference at statement creation time and verifies parameter types.
		 </p><p>
			 User-defined functions can be also be invoked on instances of an event: Please see <a href="epl_clauses.html#epl-from-clause-stream-name" title="4.4.5.&nbsp;Using the Stream Name">Section&nbsp;4.4.5, &#8220;Using the Stream Name&#8221;</a> to invoke event instance methods on a named stream.
		 </p><p>
			 The example below assumes a class <tt class="literal">MyClass</tt> that exposes a public static method <tt class="literal">myFunction</tt> accepting 2 parameters, and
			 returing a numeric type such as <tt class="literal">double</tt>.
		 </p><pre class="programlisting">select 3 * com.mycompany.MyClass.myFunction(price, volume) as myValue 
from StockTick.win:time(30 sec)</pre><p>
			 User-defined functions also take array parameters as this example shows. The section on <a href="epl-operator.html#epl-operator-ref-array" title="7.5.&nbsp;Array Definition Operator">Section&nbsp;7.5, &#8220;Array Definition Operator&#8221;</a> outlines in more detail the types of arrays produced.
		 </p><pre class="programlisting">select * from RFIDEvent where com.mycompany.rfid.MyChecker.isInZone(zone, {10, 20, 30})</pre><p>
			Java class names have to be fully qualified (e.g. java.lang.Math) but Esper provides a mechanism for user-controlled imports of classes and packages as outlined in <a href="configuration.html#config-class--package-imports" title="11.4.5.&nbsp;Class and package imports">Section&nbsp;11.4.5, &#8220;Class and package imports&#8221;</a>.
		</p><p>
			 User-defined functions can return any value including <tt class="literal">null</tt>, Java objects or arrays. Therefore user-defined functions can serve to transform, convert or map events, or to extract information and assemble further events.
		 </p><p>
			 The following statement is a simple pattern that looks for events of type E1 that are followed by events of type E2. It assigns the tags "e1" and "e2" that the function can use to assemble a final event for output:
		 </p><pre class="programlisting">select MyLib.mapEvents(e1, e2) from pattern [every e1=E1 -&gt; e2=E2]</pre><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="epl-function-user-defined-converting"></a>8.3.1.&nbsp;Event Type Conversion via User-Defined Function</h4></div></div><div></div></div><p>
				 A function that converts from one event type to another event type is shown in the next example. The first statement declares a stream that consists of MyEvent events. The second statement employs a conversion function to convert MyOtherEvent events to events of type MyEvent:
			 </p><pre class="programlisting">insert into MyStream select * from MyEvent
	insert into MyStream select MyLib.convert(other) from MyOtherEvent as other</pre><p>
				 In the example above, assuming the event classes MyEvent and MyOtherEvent are Java classes, the static method should have the following footprint:
			 </p><pre class="programlisting">public static MyEvent convert(MyOtherEvent otherEvent)</pre></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="epl-function-user-defined-cached"></a>8.3.2.&nbsp;User-Defined Function Result Cache</h4></div></div><div></div></div><p>
				 For user-defined functions that take no parameters or only constants as parameters the engine automatically caches the return result of the function, and invokes the function only once. This is beneficial to performance 
				 if your function indeed returns the same result for the same input parameters.
			</p><p>
				 You may disable caching of return values of user-defined functions via configuration as described in <a href="configuration.html#config-engine-expression-udfcache" title="11.4.18.3.&nbsp;User-Defined Function or Static Method Cache">Section&nbsp;11.4.18.3, &#8220;User-Defined Function or Static Method Cache&#8221;</a>.
			</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="epl-function-user-defined-matching"></a>8.3.3.&nbsp;Parameter Matching</h4></div></div><div></div></div><p>
				 EPL follows Java standards in terms of widening, performing widening automatically in cases where widening type conversion is allowed without loss of precision, for both boxed and primitive types.				 
			 </p><p>
				 When user-defined functions are overloaded, the function with the best match is selected based on how well the arguments to a function can match up with the parameters, giving preference to the function that requires the least number of widening conversions.
			 </p><p>
				 Boxing and unboxing of arrays is not supported in UDF as it is not supported in Java. For example, an array of <tt class="literal">Integer</tt> and an array of <tt class="literal">int</tt> are not compatible types.
			 </p><p>
				 When using <tt class="literal">{}</tt> array syntax in EPL, the resulting type is always a boxed type: <tt class="literal">"{1, 2}"</tt> is an array of <tt class="literal">Integer</tt> (and not <tt class="literal">int</tt> since it may contain null values), <tt class="literal">"{1.0, 2d}"</tt> is an array of <tt class="literal">Double</tt> and <tt class="literal">"{'A', "B"}"</tt> is an array of <tt class="literal">String</tt>, while <tt class="literal">"{1, "B", 2.0}"</tt> is an array of <tt class="literal">Object</tt> (<tt class="literal">Object[]</tt>).
			 </p></div></div></div><hr xmlns="http://www.w3.org/TR/xhtml1/transitional"><center xmlns="http://www.w3.org/TR/xhtml1/transitional">&copy; 2009 EsperTech Inc. All Rights Reserved</center><script xmlns="http://www.w3.org/TR/xhtml1/transitional" type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	</script><script xmlns="http://www.w3.org/TR/xhtml1/transitional" type="text/javascript">
	var pageTracker = _gat._getTracker("UA-1261295-1");
	pageTracker._trackPageview();
	</script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="epl-operator.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="epl-views.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;7.&nbsp;EPL Reference: Operators&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;9.&nbsp;EPL Reference: Views</td></tr></table></div></body></html>